1. 작업 목표
--------------------------------------------------------------------------------
roi_metadata.csv의 실제 ROI 수가 16,011개로 확인됨에 따라,
전체 데이터를 학습에 사용하는 것이 비현실적이므로 우선순위 기반 샘플 선별
기준을 분석하고, 효과적인 학습 전략을 수립한다.

2. 데이터 현황 분석
--------------------------------------------------------------------------------

2-1. 전체 데이터 규모
  - 파일: data/processed/roi_patches/roi_metadata.csv
  - 총 ROI 수: 16,011개 (헤더 제외)

2-2. 전체 학습 시 예상 소요 시간
  - 16,011 샘플 / batch=1 / grad_accum=4 → steps/epoch = 4,003
  - 100 epoch 기준 총 steps = 400,300
  - T4 GPU 기준: ~170~220시간 (Colab에서 비현실적)
  - A100 GPU 기준: ~33~55시간 (여전히 과도)

3. 학습 대상 선별 기준 (roi_metadata.csv 컬럼 분석)
--------------------------------------------------------------------------------

roi_metadata.csv에는 ROI 추출 단계에서 계산된 품질 지표가 포함되어 있다.
이를 활용하여 학습에 적합한 고품질 샘플을 우선 선별할 수 있다.

3-1. recommendation (종합 등급) - 1차 필터
  - ROI 추출 시 자동 평가된 종합 등급
  - 확인된 값: "suitable", "acceptable"
  - "suitable": 학습에 적합한 고품질 ROI
  - "acceptable": 사용 가능하지만 품질이 다소 낮음
  - 활용: recommendation == "suitable"로 1차 필터링

3-2. suitability_score (종합 적합도, 0~1) - 정렬 기준
  - ROI의 학습 적합도를 종합 수치화한 점수
  - 높을수록 학습에 적합
  - 관측값 범위: ~0.50 ~ ~0.93
  - 활용: 1차 필터 후 내림차순 정렬하여 상위 N개 추출

3-3. matching_score (매칭 점수, 0.3~1.0) - 품질 보조 기준
  - 결함 패턴이 해당 클래스 특성에 얼마나 부합하는지
  - 1.0: 클래스 특성에 완벽 부합
  - 0.7: 보통
  - 0.3: 부합도 낮음
  - 활용: matching_score가 낮은 샘플은 노이즈 가능성 있어 제외 고려

3-4. continuity_score (연속성 점수, 0~1) - 품질 보조 기준
  - 결함 영역의 연속성/일관성
  - 높을수록 깨끗한 결함 패턴
  - 활용: 결함 형태가 명확한 샘플 우선 선택

3-5. stability_score (안정성 점수, 0~1) - 학습 안정성 기준
  - 수치적 안정성 지표
  - 낮은 값은 학습 시 NaN 등 수치 불안정 유발 가능
  - 활용: 극단적으로 낮은 값(~0.03 등) 제외

3-6. 기하학적 특성 - 노이즈 제거 기준

  | 컬럼         | 의미                    | 활용                              |
  |-------------|------------------------|-----------------------------------|
  | area        | 결함 픽셀 수              | 너무 작은 결함 제외 (노이즈)          |
  | linearity   | 선형성 (0~1)             | 결함 형태 분류 보조                  |
  | solidity    | 밀도 (0~1)              | 결함 형태 품질 판단                  |
  | extent      | 경계박스 대비 면적 비율      | 너무 희소한 결함 제외                 |
  | aspect_ratio| 종횡비                   | 극단적 형태 필터링                   |

3-7. 카테고리 기준 - 다양성 확보

  | 컬럼             | 확인된 값                                          | 활용           |
  |-----------------|---------------------------------------------------|---------------|
  | class_id        | 1, 2, 3, 4                                        | 클래스 균형     |
  | defect_subtype  | linear_scratch, compact_blob, general              | 결함 유형 다양성 |
  | background_type | smooth, complex_pattern, vertical_stripe,          | 배경 다양성     |
  |                 | horizontal_stripe                                  |               |

4. 권장 선별 전략
--------------------------------------------------------------------------------

4-1. 기본 전략 (우선순위 기반 다단계 필터링)
  1단계: recommendation == "suitable" 필터링 → 고품질 ROI 풀 확보
  2단계: suitability_score 내림차순 정렬 → 상위 N개 후보 선정
  3단계: class_id별 균등 분배 (기존 _stratified_sample 활용)
  4단계: 같은 클래스 내에서 defect_subtype, background_type 다양성 확보
